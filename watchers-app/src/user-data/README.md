# User data

This contains code to interface with the MySQL database containing the user profile data for the application.

## Usage

### Prequisites

In the repository root directory (the git directory containing the entire project), make sure your repo is up to date with `git fetch`, then `git status` to check. 

If your git is up to date then run `npm install` in the repository root directory.

Make sure you have installed MySQL or MariaDB. Either one should work.

### Setup (this only needs to be done once per machine/server)

#### Setup MySQL

In your terminal, run the command `mysqld` (this is the MySQL background process). Alternatively, if you installed via Homebrew (on macOS) run `brew services start mysql` or if you installed MariaDB instead, `brew services start mariadb`.

#### Setup the .env file

Create a file in the `watchers-app/src/user-data/mysql` directory, named `.env`.

Within it, add the following text: 

```env
MYSQL_USERNAME = "watchersDev"
MYSQL_PASSWORD = "<your password here>"
```

Where `<your password here>` is replaced by a secure password of your choosing (this is for the local dev account). We use the `.env` file so that the passwords are never committed by git (check .gitignore)!

#### setup the watchersDev user

```sql
create database if not exists watchersUserDB;
grant all privileges on watchersUserDB.* TO 'watchersDev'@'localhost' identified by '<your password here>';
```

Again, replace `<your password here>` with the password you chose.

#### Run the init file
`mysql --user=watchersDev --password=<Your password here> watchersUserDB watchers-dev-account-init.sql`

## User profile data concept

MongoDB is chosen as a NoSQL database. Using the JSON model of data access, it is easy to program with and use while remaining performant at scale.

The user data contains the following components:
- user unique ID
- username
- password hash
- display name

The user posts data are in another collection differentiated using the unique ID
- post type (profile-post)
	- user unique ID
	- post unique ID
	- post text content
	- referenced movie unique ID
	- post likes:
		- user account likes (unique ID list)
	- post comments (only relevant if profile-post):
		- each comment body contains
			- commenting user unique ID
			- comment unique ID
			- comment text content
			- comment likes:
			- user account likes (unique ID list)

## User authentication

We use a password which is stored in a hashed format generated by `bcrypt`.

## TODO/future goals

- The unique IDs could be created in a manner similar to the [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) used by Twitter. 
	- The snowflake ID is used to dynamically generate the user registration time deterministically yet in a manner that scales. This is also used for posts and comments.
- add media embeds to posts
- implement generation of unique IDs
- expand beyond movies
- consider performance of comment loading mechanism
- do we want to store comments separately? (separate comments and posts e.g. Instagram/Facebook etc) or display comments are also posts i.e. blur boundary between comments and posts (e.g. Twitter)
- consider security of login/hash or use Auth0 or another authentication service
- Use MongoDB or another NoSQL database for scalability
